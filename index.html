<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Win98é£æ ¼æ‰«é›·</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'win98-blue': '#000080',
                        'win98-light-blue': '#0000FF',
                        'win98-gray': '#C0C0C0',
                        'win98-dark-gray': '#808080',
                        'win98-black': '#000000',
                        'win98-white': '#FFFFFF',
                    },
                    fontFamily: {
                        'win98': ['"MS Sans Serif"', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .window-border {
                @apply border-t-2 border-l-2 border-r-[3px] border-b-[3px] 
                       border-win98-white border-t-win98-white border-l-win98-white 
                       border-r-win98-dark-gray border-b-win98-dark-gray;
            }
            .window-inside {
                @apply border-t-[3px] border-l-[3px] border-r-2 border-b-2 
                       border-t-win98-dark-gray border-l-win98-dark-gray 
                       border-r-win98-white border-b-win98-white;
            }
            .button-raised {
                @apply border-t-2 border-l-2 border-r-2 border-b-2 
                       border-t-win98-white border-l-win98-white 
                       border-r-win98-dark-gray border-b-win98-dark-gray;
            }
            .button-pressed {
                @apply border-t-2 border-l-2 border-r-2 border-b-2 
                       border-t-win98-dark-gray border-l-win98-dark-gray 
                       border-r-win98-white border-b-win98-white;
            }
            .cell-unrevealed {
                @apply button-raised bg-win98-gray cursor-pointer 
                       hover:bg-[#D0D0D0] transition-colors;
            }
            .cell-revealed {
                @apply button-pressed bg-win98-gray text-center;
            }
            .counter-digit {
                @apply w-8 h-12 bg-win98-black text-[clamp(1.5rem,3vw,2rem)] 
                       font-bold text-red-500 flex items-center justify-center;
            }
            .cell-number {
                @apply font-bold text-[clamp(0.75rem,2vw,1.25rem)] leading-none;
            }
            .stats-panel {
                @apply window-inside p-2 mb-2 text-sm flex items-center justify-center;
            }
            .stats-image {
                @apply h-6 w-auto ml-1 mr-1 align-middle;
            }
        }
    </style>
</head>
<body class="bg-win98-blue min-h-screen flex items-center justify-center p-4 font-win98">
    <div class="window-border bg-win98-gray p-1 max-w-md w-full mx-auto">
        <!-- çª—å£æ ‡é¢˜æ  -->
        <div class="bg-win98-blue text-white p-1 flex items-center justify-between mb-2">
            <div class="flex items-center">
                <i class="fa-solid fa-flag mr-2"></i>
                <span class="font-bold">æ‰«é›·</span>
            </div>
            <button class="button-raised bg-win98-gray text-win98-black px-1 py-0 text-xs font-bold">
                <i class="fa-solid fa-xmark"></i>
            </button>
        </div>
        
        <!-- ç»Ÿè®¡é¢æ¿ -->
        <div class="stats-panel">
            <span>ä½ å·²ç»è¿›å…¥æ‰«é›·</span>
            <img src="https://w.saobby.com/w/ihg4kx6s" alt="è®¡æ•°å™¨" class="stats-image">
            <span>æ¬¡äº†</span>
        </div>
        
        <!-- æ¸¸æˆä¿¡æ¯æ  -->
        <div class="window-inside p-2 mb-2">
            <div class="flex justify-between items-center">
                <!-- åœ°é›·è®¡æ•°å™¨ -->
                <div class="flex counter-digit">
                    <span id="mine-counter">040</span>
                </div>
                
                <!-- é‡ç½®æŒ‰é’® -->
                <button id="reset-button" class="button-raised bg-win98-gray p-1">
                    <span class="text-xl">ğŸ˜Š</span>
                </button>
                
                <!-- è®¡æ—¶å™¨ -->
                <div class="flex counter-digit">
                    <span id="timer">000</span>
                </div>
            </div>
        </div>
        
        <!-- æ¸¸æˆéš¾åº¦é€‰æ‹© -->
        <div class="window-inside p-2 mb-2">
            <div class="flex justify-between">
                <button class="difficulty-btn button-raised bg-win98-gray px-2 py-1 text-sm" data-rows="9" data-cols="9" data-mines="10">
                    åˆçº§
                </button>
                <button class="difficulty-btn button-raised bg-win98-gray px-2 py-1 text-sm" data-rows="16" data-cols="16" data-mines="40">
                    ä¸­çº§
                </button>
                <button class="difficulty-btn button-raised bg-win98-gray px-2 py-1 text-sm" data-rows="16" data-cols="30" data-mines="99">
                    é«˜çº§
                </button>
            </div>
        </div>
        
        <!-- æ¸¸æˆåŒºåŸŸ -->
        <div id="game-board" class="window-inside p-1 grid gap-0">
            <!-- æ‰«é›·ç½‘æ ¼å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
        </div>
        
        <!-- çŠ¶æ€æ  -->
        <div class="window-inside p-1 mt-2 text-xs">
            <div class="flex justify-between">
                <div>Win98é£æ ¼æ‰«é›·</div>
                <div>Â© 2025</div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // æ¸¸æˆé…ç½®
            let config = {
                rows: 16,
                cols: 16,
                mines: 40
            };
            
            // æ¸¸æˆçŠ¶æ€
            let gameState = {
                board: [],
                mineLocations: new Set(),
                revealed: new Set(),
                flagged: new Set(),
                gameOver: false,
                gameWon: false,
                startTime: null,
                timerInterval: null,
                elapsedTime: 0
            };
            
            // DOM å…ƒç´ 
            const gameBoard = document.getElementById('game-board');
            const resetButton = document.getElementById('reset-button');
            const mineCounter = document.getElementById('mine-counter');
            const timerDisplay = document.getElementById('timer');
            const difficultyButtons = document.querySelectorAll('.difficulty-btn');
            
            // åˆå§‹åŒ–æ¸¸æˆ
            function initGame() {
                // é‡ç½®æ¸¸æˆçŠ¶æ€
                gameState = {
                    board: Array(config.rows).fill().map(() => Array(config.cols).fill(0)),
                    mineLocations: new Set(),
                    revealed: new Set(),
                    flagged: new Set(),
                    gameOver: false,
                    gameWon: false,
                    startTime: null,
                    timerInterval: null,
                    elapsedTime: 0
                };
                
                // æ¸…ç©ºæ¸¸æˆæ¿
                gameBoard.innerHTML = '';
                
                // è®¾ç½®æ¸¸æˆæ¿å°ºå¯¸
                gameBoard.style.gridTemplateColumns = `repeat(${config.cols}, minmax(0, 1fr))`;
                
                // ç”Ÿæˆåœ°é›·
                generateMines();
                
                // è®¡ç®—æ•°å­—
                calculateNumbers();
                
                // æ¸²æŸ“æ¸¸æˆæ¿
                renderBoard();
                
                // æ›´æ–°è®¡æ•°å™¨
                updateMineCounter();
                updateTimer();
                
                // é‡ç½®è¡¨æƒ…
                resetButton.innerHTML = '<span class="text-xl">ğŸ˜Š</span>';
            }
            
            // ç”Ÿæˆåœ°é›·
            function generateMines() {
                let minesPlaced = 0;
                while (minesPlaced < config.mines) {
                    const row = Math.floor(Math.random() * config.rows);
                    const col = Math.floor(Math.random() * config.cols);
                    const key = `${row},${col}`;
                    
                    if (!gameState.mineLocations.has(key)) {
                        gameState.mineLocations.add(key);
                        gameState.board[row][col] = 'M';
                        minesPlaced++;
                    }
                }
            }
            
            // è®¡ç®—æ¯ä¸ªæ ¼å­å‘¨å›´çš„åœ°é›·æ•°
            function calculateNumbers() {
                for (let row = 0; row < config.rows; row++) {
                    for (let col = 0; col < config.cols; col++) {
                        if (gameState.board[row][col] === 'M') continue;
                        
                        let count = 0;
                        // æ£€æŸ¥å‘¨å›´çš„8ä¸ªæ ¼å­
                        for (let i = Math.max(0, row - 1); i <= Math.min(row + 1, config.rows - 1); i++) {
                            for (let j = Math.max(0, col - 1); j <= Math.min(col + 1, config.cols - 1); j++) {
                                if (i === row && j === col) continue;
                                if (gameState.mineLocations.has(`${i},${j}`)) {
                                    count++;
                                }
                            }
                        }
                        
                        gameState.board[row][col] = count;
                    }
                }
            }
            
            // æ¸²æŸ“æ¸¸æˆæ¿
            function renderBoard() {
                for (let row = 0; row < config.rows; row++) {
                    for (let col = 0; col < config.cols; col++) {
                        const cell = document.createElement('div');
                        cell.dataset.row = row;
                        cell.dataset.col = col;
                        cell.classList.add('cell-unrevealed', 'aspect-square', 'flex', 'items-center', 'justify-center');
                        
                        const key = `${row},${col}`;
                        
                        // å³é”®æ ‡è®°åœ°é›·
                        cell.addEventListener('contextmenu', (e) => {
                            e.preventDefault();
                            if (gameState.gameOver || gameState.gameWon) return;
                            
                            // å¼€å§‹è®¡æ—¶
                            if (!gameState.startTime) {
                                startTimer();
                            }
                            
                            const key = `${row},${col}`;
                            
                            // å¦‚æœå·²ç»ç¿»å¼€ï¼Œä¸åšå¤„ç†
                            if (gameState.revealed.has(key)) return;
                            
                            // åˆ‡æ¢æ ‡è®°çŠ¶æ€
                            if (gameState.flagged.has(key)) {
                                gameState.flagged.delete(key);
                                cell.innerHTML = '';
                                cell.classList.remove('button-pressed');
                                cell.classList.add('cell-unrevealed');
                            } else {
                                gameState.flagged.add(key);
                                cell.innerHTML = '<i class="fa-solid fa-flag text-win98-red"></i>';
                                cell.classList.remove('cell-unrevealed');
                                cell.classList.add('button-pressed');
                            }
                            
                            updateMineCounter();
                            checkWinCondition();
                        });
                        
                        // å·¦é”®ç‚¹å‡»ç¿»å¼€æ ¼å­
                        cell.addEventListener('click', () => {
                            if (gameState.gameOver || gameState.gameWon) return;
                            
                            // å¼€å§‹è®¡æ—¶
                            if (!gameState.startTime) {
                                startTimer();
                            }
                            
                            const key = `${row},${col}`;
                            
                            // å¦‚æœå·²ç»ç¿»å¼€æˆ–æ ‡è®°ï¼Œä¸åšå¤„ç†
                            if (gameState.revealed.has(key) || gameState.flagged.has(key)) return;
                            
                            // ç¿»å¼€æ ¼å­
                            revealCell(row, col);
                            
                            // æ£€æŸ¥èƒœåˆ©æ¡ä»¶
                            checkWinCondition();
                        });
                        
                        gameBoard.appendChild(cell);
                    }
                }
            }
            
            // ç¿»å¼€æ ¼å­
            function revealCell(row, col) {
                const key = `${row},${col}`;
                
                // å¦‚æœå·²ç»ç¿»å¼€æˆ–æ ‡è®°ï¼Œä¸åšå¤„ç†
                if (gameState.revealed.has(key) || gameState.flagged.has(key)) return;
                
                // æ ‡è®°ä¸ºå·²ç¿»å¼€
                gameState.revealed.add(key);
                
                // æ›´æ–°UI
                const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
                cell.classList.remove('cell-unrevealed');
                cell.classList.add('cell-revealed');
                
                // è·å–æ ¼å­å†…å®¹
                const cellContent = gameState.board[row][col];
                
                // å¦‚æœæ˜¯åœ°é›·ï¼Œæ¸¸æˆç»“æŸ
                if (cellContent === 'M') {
                    gameOver(false);
                    return;
                }
                
                // æ˜¾ç¤ºæ•°å­—
                if (cellContent > 0) {
                    const colors = [
                        '',           // 0 (ä¸ä¼šæ˜¾ç¤º)
                        'text-blue-700',  // 1
                        'text-green-700', // 2
                        'text-red-600',   // 3
                        'text-win98-blue', // 4
                        'text-red-800',   // 5
                        'text-cyan-700',  // 6
                        'text-black',     // 7
                        'text-gray-500'   // 8
                    ];
                    cell.innerHTML = `<span class="${colors[cellContent]} cell-number">${cellContent}</span>`;
                    return;
                }
                
                // å¦‚æœæ˜¯0ï¼Œé€’å½’ç¿»å¼€å‘¨å›´çš„æ ¼å­
                for (let i = Math.max(0, row - 1); i <= Math.min(row + 1, config.rows - 1); i++) {
                    for (let j = Math.max(0, col - 1); j <= Math.min(col + 1, config.cols - 1); j++) {
                        if (i === row && j === col) continue;
                        revealCell(i, j);
                    }
                }
            }
            
            // æ¸¸æˆç»“æŸ
            function gameOver(isWin) {
                gameState.gameOver = true;
                clearInterval(gameState.timerInterval);
                
                // æ›´æ–°è¡¨æƒ…
                resetButton.innerHTML = isWin ? '<span class="text-xl">ğŸ˜</span>' : '<span class="text-xl">ğŸ˜µ</span>';
                
                // æ˜¾ç¤ºæ‰€æœ‰åœ°é›·
                if (!isWin) {
                    gameState.mineLocations.forEach(key => {
                        const [row, col] = key.split(',').map(Number);
                        
                        // å¦‚æœåœ°é›·æ²¡æœ‰è¢«æ ‡è®°ï¼Œæ˜¾ç¤ºåœ°é›·
                        if (!gameState.flagged.has(key)) {
                            const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
                            cell.classList.remove('cell-unrevealed');
                            cell.classList.add('cell-revealed');
                            cell.innerHTML = '<i class="fa-solid fa-bomb text-win98-black"></i>';
                        }
                    });
                    
                    // æ˜¾ç¤ºé”™è¯¯æ ‡è®°
                    gameState.flagged.forEach(key => {
                        if (!gameState.mineLocations.has(key)) {
                            const [row, col] = key.split(',').map(Number);
                            const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
                            cell.classList.remove('cell-unrevealed');
                            cell.classList.add('cell-revealed');
                            cell.innerHTML = '<i class="fa-solid fa-times text-win98-red"></i>';
                        }
                    });
                }
            }
            
            // æ£€æŸ¥èƒœåˆ©æ¡ä»¶
            function checkWinCondition() {
                // èƒœåˆ©æ¡ä»¶ï¼šæ‰€æœ‰éåœ°é›·æ ¼å­éƒ½è¢«ç¿»å¼€
                const totalCells = config.rows * config.cols;
                const minesCount = config.mines;
                const revealedCount = gameState.revealed.size;
                const flaggedCount = gameState.flagged.size;
                
                // ä¸¤ç§èƒœåˆ©æ¡ä»¶ï¼š
                // 1. æ‰€æœ‰éåœ°é›·æ ¼å­éƒ½è¢«ç¿»å¼€
                // 2. æ‰€æœ‰åœ°é›·éƒ½è¢«æ­£ç¡®æ ‡è®°
                if (revealedCount === totalCells - minesCount || 
                    (flaggedCount === minesCount && Array.from(gameState.flagged).every(key => gameState.mineLocations.has(key)))) {
                    gameState.gameWon = true;
                    gameOver(true);
                    
                    // è‡ªåŠ¨æ ‡è®°æ‰€æœ‰åœ°é›·
                    gameState.mineLocations.forEach(key => {
                        if (!gameState.flagged.has(key)) {
                            const [row, col] = key.split(',').map(Number);
                            const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
                            cell.innerHTML = '<i class="fa-solid fa-flag text-win98-red"></i>';
                        }
                    });
                }
            }
            
            // å¼€å§‹è®¡æ—¶å™¨
            function startTimer() {
                gameState.startTime = Date.now() - gameState.elapsedTime;
                gameState.timerInterval = setInterval(() => {
                    gameState.elapsedTime = Date.now() - gameState.startTime;
                    updateTimer();
                }, 1000);
            }
            
            // æ›´æ–°è®¡æ—¶å™¨æ˜¾ç¤º
            function updateTimer() {
                const seconds = Math.floor(gameState.elapsedTime / 1000);
                timerDisplay.textContent = seconds.toString().padStart(3, '0');
            }
            
            // æ›´æ–°åœ°é›·è®¡æ•°å™¨
            function updateMineCounter() {
                const remainingMines = config.mines - gameState.flagged.size;
                mineCounter.textContent = Math.max(0, remainingMines).toString().padStart(3, '0');
            }
            
            // é‡ç½®æŒ‰é’®äº‹ä»¶
            resetButton.addEventListener('click', initGame);
            
            // éš¾åº¦é€‰æ‹©æŒ‰é’®äº‹ä»¶
            difficultyButtons.forEach(button => {
                button.addEventListener('click', () => {
                    config.rows = parseInt(button.dataset.rows);
                    config.cols = parseInt(button.dataset.cols);
                    config.mines = parseInt(button.dataset.mines);
                    
                    // ç§»é™¤æ‰€æœ‰æŒ‰é’®çš„æŒ‰ä¸‹çŠ¶æ€
                    difficultyButtons.forEach(btn => {
                        btn.classList.remove('button-pressed');
                        btn.classList.add('button-raised');
                    });
                    
                    // æ·»åŠ å½“å‰æŒ‰é’®çš„æŒ‰ä¸‹çŠ¶æ€
                    button.classList.remove('button-raised');
                    button.classList.add('button-pressed');
                    
                    initGame();
                });
            });
            
            // é»˜è®¤é€‰æ‹©ä¸­çº§éš¾åº¦
            document.querySelector('[data-rows="16"][data-cols="16"][data-mines="40"]').click();
        });
    </script>
</body>
</html>
